[
  {
    "hash": "f05a249a9c233506e43ca9cbfd143f18b5782f84",
    "short_hash": "f05a249",
    "author": "James Brink",
    "date": "2025-12-15T19:08:01-07:00",
    "message": "feat: Add deciduous decision graph integration\n\nIntegrate deciduous (https://github.com/notactuallytreyanastasio/deciduous)\nfor tracking architectural decisions and development history.\n\n- Add Claude Code slash commands for decision management (/context, /decision)\n- Add decision graph workflow documentation to CLAUDE.md\n- Add GitHub Pages deployment for graph visualization\n- Add workflow to cleanup stale decision graphs\n- Initialize graph with 38 nodes covering project history from git commits\n- Minor code formatting fixes from ruff",
    "files_changed": 13
  },
  {
    "hash": "fcb471f80b8c45d99c307ef2136deed6d840bdcb",
    "short_hash": "fcb471f",
    "author": "James Brink",
    "date": "2025-12-14T22:39:08-07:00",
    "message": "fix: Address code review security and robustness concerns (#9)\n\n* fix: Address code review security and robustness concerns\n\nSecurity improvements:\n- Add error handling for docker pull in CUDA manifest creation\n- Improve path traversal validation with canonical path check\n- Add HTTPS URL scheme validation for downloads\n- Check for absolute paths and .. in filenames\n\nCode quality:\n- Remove unused variable 'i' in download loop\n- Add MIN_EXPECTED_TEMPLATE_FILES constant (was magic number 20)\n\nThese changes address the \"Must Fix\" and \"Should Fix\" items from\nthe code review on PR #8.\n\n* fix: Address follow-up code review feedback\n\n- Remove realpath dependency for cross-platform compatibility (macOS)\n- Simplify path validation condition (remove redundant regex check)\n- Add error handling for docker tag and push operations",
    "files_changed": 2
  },
  {
    "hash": "e5971a424f97b53d1aaba592fa79414b34bd9ca0",
    "short_hash": "e5971a4",
    "author": "James Brink",
    "date": "2025-12-14T22:31:30-07:00",
    "message": "feat: Add multi-arch Docker builds and auto-download template inputs (#8)\n\n* feat: Add multi-arch Docker builds and auto-download template inputs\n\nMulti-architecture Docker support:\n- Build CPU images for both amd64 and arm64 (Apple Silicon compatible)\n- CUDA images remain x86_64 only (NVIDIA requirement)\n- Use QEMU emulation in CI for cross-architecture builds\n- Create multi-arch manifests for seamless pulling on any platform\n- Update README with Apple Silicon Docker instructions\n\nAuto-download workflow template input files:\n- Add template_inputs.sh script to download example images on startup\n- Fetch manifest from GitHub workflow_templates repository\n- Non-blocking download (doesn't fail startup if network unavailable)\n- Cache manifest for 7 days to minimize network requests\n- Skip existing files for faster subsequent startups\n- Add curl and jq to runtime PATH via makeWrapper\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Address code review security and robustness concerns\n\nSecurity improvements in template_inputs.sh:\n- Add path traversal validation to reject file paths containing \"..\"\n- Add file size validation (50MB limit) to prevent DoS attacks\n- Add file type validation using MIME type checking\n- Validate JSON manifest structure before processing\n\nRobustness improvements:\n- Capture and display actual curl error messages for debugging\n- Add atomic write pattern with empty file validation\n- Platform-agnostic file size detection (macOS/Linux compatible)\n- Remove unused display_name variable (shellcheck warning)\n\nCI/CD improvements in docker.yml:\n- Add manifest existence verification before creating multi-arch manifests\n- Use variables for architecture-specific tags for consistency\n- Add clear error messages when builds fail\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n---------\n\nCo-authored-by: Claude Opus 4.5 <noreply@anthropic.com>",
    "files_changed": 6
  },
  {
    "hash": "8cc28428fd05a10ea3d6401d43bb72a9861be051",
    "short_hash": "8cc2842",
    "author": "James Brink",
    "date": "2025-12-14T19:02:29-07:00",
    "message": "feat: Add proper --base-directory support for custom data locations (#7)\n\n* feat: Add proper --base-directory support for custom data locations\n\n- Parse --base-directory in bash config before setting up paths\n- Update Python persistence module to respect user-specified base directory\n- Keep app code and venv fixed in ~/.config/comfy-ui/ (managed by nix)\n- Allow all data (models, input, output, custom_nodes) to use custom location\n- Update README with --base-directory documentation and examples\n\nThis enables storing all ComfyUI data on a separate drive (e.g., ZFS volume)\nwhile keeping the app installation in a fixed location.\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Address code review feedback for --base-directory support\n\n- Consolidate argument parsing into single loop with skip_next flag\n- Filter --base-directory from ARGS passed to ComfyUI\n- Add validation for base directory parent existence\n- Add comment explaining dual parsing in bash and Python\n- Update CLAUDE.md with command line options and clarified data structure\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Handle --base-directory=value form and add write permission check\n\n- Python now handles both --base-directory VALUE and --base-directory=VALUE\n- Add write permission validation for parent directory\n- Document quoting paths with spaces in README\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Address second code review - eliminate race condition and add security\n\nChanges:\n- Remove duplicate argument parsing from Python persistence.py\n  - Python now trusts COMFY_USER_DIR env var set by bash\n  - Eliminates potential inconsistency between bash/Python parsing\n- Remove sys.argv modification anti-pattern from persistence.py\n- Refactor config.sh to use proper function for argument parsing\n  - Consistent use of local variables\n  - Validates next argument isn't a flag (--base-directory --open)\n  - Converts relative paths to absolute with realpath\n- Add path traversal security validation\n  - Restricts paths to home directory and common data mounts\n  - Prevents attacks like --base-directory \"../../../../etc\"\n- Fix ShellCheck warnings for unused arrays (SC2034)\n- Document why echo is used before logger.sh is sourced\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Address third code review - fix critical race condition and security\n\nCritical fixes:\n- Pass \"$@\" when sourcing config.sh to fix argument parsing race condition\n  - BASE_DIR was always using default because $@ was empty when sourced\n  - Now launcher.sh passes arguments: source \"$SCRIPT_DIR/config.sh\" \"$@\"\n\nSecurity improvements:\n- Change path validation from allowlist to blocklist approach\n  - Allows custom mount points (/storage, /ai-models, etc.)\n  - Blocks dangerous system directories (/etc, /bin, /usr, etc.)\n- Add symlink attack protection\n  - Resolves symlinks in parent directory before validation\n  - Re-validates resolved path to prevent symlink-to-system-dir attacks\n- Add Python-side path validation (defense in depth)\n  - Validates absolute path requirement\n  - Blocks system directories even if bash validation bypassed\n\nCode quality:\n- Export COMFY_APP_DIR in export_config() for Python persistence module\n- Improve realpath fallback with command existence check\n- Handle quoted paths edge case (strip surrounding quotes)\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Sync blocklist between bash and Python (add /lib32, /root, /lib64)\n\nAddresses Claude review feedback:\n- Add /lib32 to both bash and Python blocklists\n- Ensure Python blocklist matches bash exactly (add /root, /lib64)\n- Add comment noting blocklists must stay in sync\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n* fix: Address final review - symlink resolution and empty parse validation\n\nFixes the two \"Must Fix\" items from Claude review:\n\n1. Fix symlink resolution to check final BASE_DIR, not just parent\n   - If user provides --base-directory /home/user/link -> /etc,\n     now properly resolves and validates the target\n   - Prevents symlink-based bypasses of security validation\n\n2. Add validation for empty/failed parse when flag is present\n   - If user provides --base-directory but parsing returns empty,\n     now properly errors instead of silently using default\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n---------\n\nCo-authored-by: Claude Opus 4.5 <noreply@anthropic.com>",
    "files_changed": 5
  },
  {
    "hash": "01334848f31b92dc303ad3e31a3d2f2d2ace5dbb",
    "short_hash": "0133484",
    "author": "James Brink",
    "date": "2025-12-10T21:22:44-07:00",
    "message": "feat: Code quality overhaul and modernization (#6)\n\n* feat: Add code quality tooling and fix all linting issues\n\n- Update ComfyUI to v0.4.0\n- Remove redundant frontend package from Nix environment\n- Add ruff and pyright configuration in pyproject.toml\n- Add Nix flake checks for code quality (ruff, pyright, shellcheck, nixfmt)\n- Add Nix flake apps for linting and type checking\n- Fix all shellcheck errors in bash scripts:\n  - Proper variable quoting\n  - Separated variable declaration and assignment\n  - Added error handling to cd commands\n  - Fixed array handling for BASE_PACKAGES and ADDITIONAL_PACKAGES\n  - Protected rm -rf operations\n- Fix all ruff linting errors in Python code:\n  - Changed logger.error to logger.exception in exception handlers\n  - Removed unused variables\n  - Fixed line length issues\n  - Added HTTP_OK constant\n  - Fixed import organization\n- Fix pyright type errors with proper null checks\n- Add meta attributes to all flake apps\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\n\n* fix: Format flake.nix with nixfmt-unstable-2025-04-04\n\n* docs: Update README with code quality tooling and version info\n\n* refactor: Comprehensive code quality improvements and fixes\n\nCI/CD:\n- Fix actions/checkout@v6 to @v4 (v6 doesn't exist)\n- Add concurrency control to prevent duplicate workflow runs\n- Fix Cachix conditional check to use secrets context\n\nNix:\n- Remove duplicated update app conditional (both branches were identical)\n- Add Docker healthcheck configuration to both CPU and CUDA images\n\nBash scripts:\n- Add source guards to all scripts to prevent multiple sourcing\n- Fix --port=* pattern quoting in config.sh case statement\n\nPython:\n- Add comprehensive type hints to all modules\n- Refactor persistence.py to use class-based state holder instead of globals\n- Fix side effect on module import (use lazy initialization)\n- Replace asyncio.TimeoutError with builtin TimeoutError\n- Use http.HTTPStatus instead of magic numbers\n- Fix exception handling order (PermissionError before OSError)\n- Remove unused imports\n\nAll checks pass: ruff, pyright, shellcheck, nixfmt, nix flake check\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\n\n---------\n\nCo-authored-by: Claude Sonnet 4.5 <noreply@anthropic.com>",
    "files_changed": 19
  },
  {
    "hash": "afb7f966089fe6fb2eb95805cca9871896e7b03e",
    "short_hash": "afb7f96",
    "author": "James Brink",
    "date": "2025-12-09T14:26:57-07:00",
    "message": "feat: Complete Docker Support with CI/CD and Public Registry (#5)\n\n* fix: Enable Docker build apps and complete Docker support\n\nFixed issue where buildDocker and buildDockerCuda apps were not\naccessible due to duplicate app definitions outside eachDefaultSystem.\nMoved the update app into the main apps definition and removed\nduplicates that were overwriting the flake outputs.\n\nChanges:\n- Consolidated all apps within eachDefaultSystem using 'rec'\n- Moved update app logic inline with platform detection\n- Verified both Docker images build successfully on Linux\n- Updated documentation to reflect fully functional Docker support\n\nDocker images now build correctly:\n- comfy-ui:latest (CPU version, 538MB)\n- comfy-ui:cuda (CUDA version, 538MB)\n\nBoth images include proper configuration for ComfyUI operation with\nvolume mounting, port exposure, and environment variables.\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\n\n* feat: Add CI/CD for Docker image publishing to GitHub Container Registry\n\nImplemented automated Docker image builds and publishing via GitHub Actions:\n\nCI/CD Features:\n- Automated builds triggered on push to main, version tags, and PRs\n- Matrix build strategy for both CPU and CUDA variants\n- Latest GitHub Actions versions (checkout@v6, install-nix-action@v31, cachix-action@v15)\n- Intelligent tagging strategy:\n  * Main branch: 'latest' and version from flake.nix\n  * Version tags: 'vX.Y.Z' and 'latest'\n  * Pull requests: 'pr-N' (build only, no push)\n- Cachix integration for faster Nix builds\n- GitHub Container Registry (ghcr.io) for public image hosting\n\nDocumentation Updates:\n- Added comprehensive Docker section with pre-built image instructions\n- Documented pull commands for both CPU and CUDA images\n- Explained CI/CD workflow and tagging strategy\n- Updated CLAUDE.md with CI/CD architecture details\n- Added registry information and required secrets\n\nImages Published:\n- ghcr.io/utensils/nix-comfyui:latest (CPU version)\n- ghcr.io/utensils/nix-comfyui:latest-cuda (CUDA version)\n- Version-tagged images (X.Y.Z and X.Y.Z-cuda)\n\nThe workflow ensures reproducible builds using Nix and provides\npublic access to pre-built Docker images, making it easier for users\nto get started without building locally.\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\n\n* fix: Skip Cachix setup when auth token is not available\n\nThe Cachix action was failing when CACHIX_AUTH_TOKEN secret was not set,\ncausing the entire Docker build workflow to fail. This fix makes the\nCachix setup step conditional - it only runs when the token is available.\n\nWithout the token, builds will proceed without Cachix caching, which is\nacceptable for CI (builds will just take longer). This allows the workflow\nto succeed immediately without requiring Cachix setup.\n\nRelated to PR #5\n\n* fix: Correct GitHub Actions conditional syntax for Cachix\n\nUse proper ${{ }} syntax for the conditional expression to check\nif CACHIX_AUTH_TOKEN secret exists. The previous syntax was invalid\nand caused workflow validation errors.\n\n* fix: Use environment variable for Cachix conditional check\n\nGitHub Actions doesn't allow secrets to be directly referenced in\nif conditions. The workaround is to set the secret as a step-level\nenvironment variable and then check the env variable in the conditional.\n\nReferences:\n- https://github.com/orgs/community/discussions/26726\n- https://github.com/orgs/community/discussions/25735\n\n---------\n\nCo-authored-by: Claude Sonnet 4.5 <noreply@anthropic.com>",
    "files_changed": 4
  },
  {
    "hash": "f8797813474a00a7f1502f9052951df3d12fcd30",
    "short_hash": "f879781",
    "author": "James Brink",
    "date": "2025-04-18T14:05:11-07:00",
    "message": "Add preliminary Docker support to flake.nix and update README.md\n\nThis commit adds Docker image building capabilities to the flake.nix file with the following features:\n\n- Docker image that includes all necessary dependencies\n\n- Volume mounting at /data for persistence\n\n- Port 8188 exposed for ComfyUI web interface\n\n- Essential utilities like bash, coreutils, netcat, and git\n\n- buildDocker command for easy image building\n\nNote: This is a partial implementation that requires cross-compilation for Linux to be fully functional",
    "files_changed": 2
  },
  {
    "hash": "e60d929f9a83bdf0c5fd3553444a9e1d90c1c6d8",
    "short_hash": "e60d929",
    "author": "James Brink",
    "date": "2025-04-18T13:39:57-07:00",
    "message": "Refactor: Convert launcher into modular script architecture\n\n- Split monolithic launcher.sh into focused modular components\n- Create config.sh for configuration variables and settings\n- Create logger.sh for consistent logging across components\n- Create install.sh for installation steps\n- Create persistence.sh for symlink creation and verification\n- Create runtime.sh for execution and process management\n- Update launcher.sh to act as a central coordinator\n- Update flake.nix to handle multiple script files\n- Add debug/verbose mode with optional detailed logging\n- Update documentation with new modular architecture details\n- Fix path resolution for Nix store environments\n\n Generated with [Claude Code](https://claude.ai/code)\n\nCo-Authored-By: Claude <noreply@anthropic.com>",
    "files_changed": 9
  },
  {
    "hash": "8b9b59f989374b9c087de054b58d137303be8b7a",
    "short_hash": "8b9b59f",
    "author": "James Brink",
    "date": "2025-04-18T12:39:43-07:00",
    "message": "Implement robust persistence for ComfyUI with model downloader integration",
    "files_changed": 11
  },
  {
    "hash": "2485e32a13d18b60c60ed04067fbdc7f8b07d066",
    "short_hash": "2485e32",
    "author": "James Brink",
    "date": "2025-04-18T03:02:37-07:00",
    "message": "Implement persistence for models, workflows, and generated images",
    "files_changed": 8
  },
  {
    "hash": "4955db85bd1fadff85a9ac0f345c4f8856318623",
    "short_hash": "4955db8",
    "author": "James Brink",
    "date": "2025-04-18T01:44:21-07:00",
    "message": "Add --open flag and improve user experience",
    "files_changed": 2
  },
  {
    "hash": "78066485b4c1d0903707c582329bd9b2a428b030",
    "short_hash": "7806648",
    "author": "James Brink",
    "date": "2025-04-17T18:51:50-07:00",
    "message": "Fix model downloader JavaScript syntax errors and improve button detection",
    "files_changed": 14
  },
  {
    "hash": "5b23178ec9c4b3ab706ce826a99a22cdaec3d179",
    "short_hash": "5b23178",
    "author": "James Brink",
    "date": "2025-04-17T15:58:30-07:00",
    "message": "Add model downloader backend implementation\n\nThis commit adds:\n- Backend API endpoint for model downloads\n- Frontend patch to intercept download buttons\n- Custom node implementation for seamless integration\n- Updated launcher script to properly install the model downloader\n\nThe implementation allows models to be downloaded directly through\nthe backend instead of requiring manual downloads and placement.",
    "files_changed": 7
  },
  {
    "hash": "69f8edb078d84caf36d09912a594fbbef1ea156a",
    "short_hash": "69f8edb",
    "author": "James Brink",
    "date": "2025-04-17T11:21:49-07:00",
    "message": "Optimize flake for Apple Silicon using pip/venv approach",
    "files_changed": 2
  },
  {
    "hash": "5494cb9d03b1c3e2c6fbafb9360a1a3cbe73dd5f",
    "short_hash": "5494cb9",
    "author": "James Brink",
    "date": "2025-04-17T03:21:38-07:00",
    "message": "fix: optimize memory handling for Apple Silicon\n\n- Disabled tcmalloc to avoid 'free invalid pointer' crashes\n- Improved PyTorch model loading with Apple MPS-specific optimizations\n- Enhanced memory patch script with safe loading and error handling\n- Configured environment variables specifically for Apple Silicon\n- Reduced memory usage with half-precision and CPU offloading",
    "files_changed": 1
  },
  {
    "hash": "8f921c02d38c875d450fed924dcc6c4ec529d71e",
    "short_hash": "8f921c0",
    "author": "James Brink",
    "date": "2025-04-17T03:15:42-07:00",
    "message": "fix: improve memory management for large models\n\n- Added PyTorch MPS environment variables to improve stability\n- Set memory management flags to prevent tcmalloc crashes\n- Configured lower precision for better memory usage with large models\n- Added Python memory allocator settings for more predictable behavior",
    "files_changed": 1
  },
  {
    "hash": "f0731f4044845e0f74473abff7cf1f842c06bc50",
    "short_hash": "f0731f4",
    "author": "James Brink",
    "date": "2025-04-17T02:12:25-07:00",
    "message": "Fix torch ecosystem version consistency by using Nix packages only",
    "files_changed": 1
  },
  {
    "hash": "be229092ce7ed708c72c0e97822a347478417804",
    "short_hash": "be22909",
    "author": "James Brink",
    "date": "2025-04-17T01:24:12-07:00",
    "message": "Fix PyTorch package collisions with hybrid dependency approach",
    "files_changed": 3
  },
  {
    "hash": "b6ca35c8bd93492c58f7b463bfcd3a324eea3e4b",
    "short_hash": "b6ca35c",
    "author": "James Brink",
    "date": "2025-04-17T01:10:29-07:00",
    "message": "Initial commit: ComfyUI Nix flake setup with Python 3.12",
    "files_changed": 3
  }
]